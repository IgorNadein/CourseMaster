{% extends 'base.html' %}

{% block title %}Оформление покупки - {{ course.title }} - CourseMaster{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col-lg-8">
            <h2 class="mb-4">Оформление покупки</h2>
            
            <!-- Карточка курса -->
            <div class="card mb-4">
                <div class="row g-0">
                    {% if course.thumbnail %}
                    <div class="col-md-4">
                        <img src="{{ course.thumbnail.url }}" class="img-fluid rounded-start" alt="{{ course.title }}">
                    </div>
                    {% endif %}
                    <div class="col-md-{% if course.thumbnail %}8{% else %}12{% endif %}">
                        <div class="card-body">
                            <h5 class="card-title">{{ course.title }}</h5>
                            <p class="card-text text-muted">{{ course.subtitle }}</p>
                            <p class="card-text">
                                <i class="bi bi-person"></i> {{ course.instructor.get_full_name|default:course.instructor.username }}<br>
                                <i class="bi bi-tag"></i> {{ course.category.name }}<br>
                                <i class="bi bi-graph-up"></i> {{ course.get_level_display }}<br>
                                <i class="bi bi-clock"></i> ~{{ course.duration_hours }} часов
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Форма оплаты -->
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-4">Способ оплаты</h5>
                    
                    <form method="post">
                        {% csrf_token %}
                        
                        <!-- Выбор способа оплаты -->
                        <div class="mb-4">
                            <h6>Выберите способ оплаты:</h6>
                            {% for radio in form.payment_method %}
                            <div class="form-check mb-3">
                                {{ radio.tag }}
                                <label class="form-check-label" for="{{ radio.id_for_label }}">
                                    {% if radio.data == 'stripe' %}
                                        <i class="bi bi-credit-card"></i> Stripe (Кредитная карта)
                                    {% elif radio.data == 'paypal' %}
                                        <i class="bi bi-paypal"></i> PayPal
                                    {% elif radio.data == 'yookassa' %}
                                        <i class="bi bi-wallet2"></i> Yookassa (Яндекс.Касса)
                                    {% endif %}
                                </label>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- Промокод -->
                        <div class="mb-4">
                            <h6>Промокод (опционально)</h6>
                            {{ form.promo_code }}
                            {% if form.promo_code.errors %}
                            <div class="alert alert-danger mt-2">{{ form.promo_code.errors }}</div>
                            {% endif %}
                        </div>

                        <!-- Согласие с условиями -->
                        <div class="mb-4">
                            <div class="form-check">
                                {{ form.agree_terms }}
                                <label class="form-check-label" for="{{ form.agree_terms.id_for_label }}">
                                    Я согласен с <a href="#" target="_blank">условиями использования</a>
                                </label>
                            </div>
                            {% if form.agree_terms.errors %}
                            <div class="alert alert-danger mt-2">{{ form.agree_terms.errors }}</div>
                            {% endif %}
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg w-100">
                            <i class="bi bi-lock"></i> Продолжить к оплате
                        </button>
                    </form>
                </div>
            </div>

            <!-- Информация о безопасности -->
            <div class="alert alert-info mt-4">
                <i class="bi bi-shield-check"></i> Ваши платежные данные защищены современным шифрованием
            </div>
        </div>

        <!-- Сбоку: сумма и детали -->
        <div class="col-lg-4">
            <div class="card sticky-top" style="top: 20px;">
                <div class="card-body">
                    <h5 class="card-title mb-3">Итого к оплате</h5>
                    
                    <div class="d-flex justify-content-between mb-2">
                        <span>Цена курса:</span>
                        <span>{{ price }} ₽</span>
                    </div>

                    {% if discount_amount > 0 %}
                    <div class="d-flex justify-content-between mb-2 text-success">
                        <span>Скидка:</span>
                        <span>-{{ discount_amount }} ₽</span>
                    </div>
                    {% endif %}

                    <hr>

                    <div class="d-flex justify-content-between mb-3">
                        <strong>Итого:</strong>
                        <strong class="text-primary" style="font-size: 1.25rem;">
                            {{ total_amount }} ₽
                        </strong>
                    </div>

                    <!-- Преимущества курса -->
                    <h6 class="mt-4 mb-3">Что вы получите:</h6>
                    <ul class="list-unstyled small">
                        <li class="mb-2">
                            <i class="bi bi-check-circle text-success"></i> Полный доступ к материалам
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle text-success"></i> Тесты и задания
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle text-success"></i> Сертификат о завершении
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle text-success"></i> Вечный доступ
                        </li>
                        <li class="mb-2">
                            <i class="bi bi-check-circle text-success"></i> Поддержка преподавателя
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
